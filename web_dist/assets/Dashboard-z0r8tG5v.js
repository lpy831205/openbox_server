import{_ as ke,u as xe,v as Ve,a as Ce,x as Me,r as f,y as k,o as ye,z as q,c as l,p as _,e as r,w as t,d as h,j as A,g as a,A as O,f as s,k as c,B as De,n as p,l as L,C as J,q as Se,t as v,D as Q,F as Pe,G as Te,H as Oe,I as ze,J as Ie,T as He,K as R,L as Ge,M as z,E as M}from"./index-IjbujgFK.js";import"./crypto-wasm-7Ru5Q_sa.js";const Fe="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'%20standalone='no'?%3e%3c!DOCTYPE%20svg%20PUBLIC%20'-//W3C//DTD%20SVG%201.1//EN'%20'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'%3e%3csvg%20version='1.1'%20id='Layer_1'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20x='0px'%20y='0px'%20width='32px'%20height='32px'%20viewBox='0%200%2032%2032'%20enable-background='new%200%200%2032%2032'%20xml:space='preserve'%3e%3cimage%20id='image0'%20width='32'%20height='32'%20x='0'%20y='0'%20xlink:href='data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAIGNIUk0AAHomAACAhAAA+gAAAIDo%20AAB1MAAA6mAAADqYAAAXcJy6UTwAAAAGYktHRAD/AP8A/6C9p5MAAAk7SURBVFjDlZdrkFXVlcd/%20+5xzT7fd0N3YKshDAQFRiESQQBsak6o2itGZmkySAazCR/ycFGNSqXEojHGocspUTL4kZVl+kdgw%20JX6YJBWTKqo0E8MrQb2NqDBGOrSRvt2m723uOeee938+nHsvDcqksqt2nfvY63HW+q//XstIEpdb%20EmQZOA4AOZD95UPyt99G778PlQpg0Lx5WDcsxbp5FfaiRVgt+TQF2wZj+H9sXGalaftjPDGh4Ic/%20VLBxo4KODgUgf8YOmtufM0f+5kEFP3pG8eTEp+q6dJlPjUCaguOQJjHRE9+HH/8Y2/PI+vpI1q8n%2027wZ3nuPdO06OPR73M9+Fp09S/dzz2EBKaDOK+DRf8XdvRvHdds6/3YEkkSS1Dh2VN6iRWqAAstS%209eGHNPnMM5rasUPVwU2q9V+pqXvv1dSGDaouXar68uWKQd6SJao8+6zqK5YrBNWXLFFw7OhFumcu%20LjWeS/L37StCazua/tKX9PFzz2lqcJP8WbOKUD/4oKI/HFP20V+Uh6GSd07K27GjSEVPr6a++lVV%20v/2opr7xsOqzZhep2r/vU53g0jf39xfG6zfeqI8f2KGpLVvkXXWVYlAD5P/XfuUzFERvvKn4rTcl%20ScHLLysAJaCgv19T69dr8rvf1fnbb286sf8TTjATJI1jxxSAvOXLNfXE91S76y6FoBgUgrxd/z7D%208HF5d9+t8zcsU+2uuzS9fbtiSf4TT6gBii1LEah6372qvPCC6qtXyQc1Wulo2kR58T5JHKu+cKG8%20lSv18dNP6/y6dYpAkW0rAvldXYpGR5VKmv7WtzTd1yfvy19WbfUq+f/zWzUOHlQ4MSH/f08r6O5u%20y4ag6cFB/XX3btWvmStv8WIlcVQ4keeyyDIAoiefxP3wQ/K+XuzTpygdPw6W1a5hs3Ej4VNPEd62%20HrN8GZ1jZ+n+5S+54qWXsFeswL76apIvfoH8vfcwAwMFwo3BWBadv/sdVrlMcv92nNFR4u8/Wfyf%20ZUUVxBMVeb09CkFRM9wxKDJGkeMoAgVDQ/J/+5rOf/7z8q65Rv599ykulxWV35I/OKh6V5emt2xR%20/cSIgqGhIgKOo8iyFBmjEFTduVPTmzfL6+xs84QFkO3di5k+T/Cd75AsXowFyLYLL/McA+jsGMlP%20n4WxMbKtW8lrNeoPPYS//X7yWd3okUegXIYTJzBjY21ZJLAsLMAcOkS6di0mDEn37gXAyoH8578o%206POPf6SVElr8JCHbxj59CntgI84j38D66U+gWsX++tewvvJPcOo05vnncR9/HOp1OHWqoOCWjjxH%20gPvmG5i+XrJbb0X79pMDxGNj8js7Vb1/u6a2bi3SYNtF+I0pQtgC4oIFChu+4jxT8OCDmrr1VlVv%20uUXBo99WKilqBPIXLLgA3pZ86wma2rpV3nXXK+jqVjw2JhqvvFLU97XXylu4sBBuCbWwYNuK7EKB%20N3euGgcPKpMU+Z6iJFYmqfGbX8vr7y/Ot3I/E0tNfX5fn8JSSQ1Q+Mqv5OjMB1hA6dy5IuKWBRJG%20InMcsjlzKE1OkrsudhbTUamQDA3RuP469JV/xgDZgQPkY2NYnZ3Ea9bglMuFrlKJvLsbp1Yrqsmy%20KNVqbXzlo6M4VCaKw52dF0BjDMQxwZ1DJAO344yUYXYPXcPDqKeHZOVNmFqV/NQp5NXR1deQ3HEH%20Tk8PuUTJtjFr1hBWq2jljfQ/9Z/IdQssOE5R3lkG4xUcY8AAhCEzr0UBMhbWnD7Swc1kf3ofd/Vq%20CEOS1aso/fVjoiuvxG6ERIsWYbq6MMffIFu6GHv+fOwmf7inThe6oqit2zQ3Bhz195N0d2P+4R9h%201c1Yc+ci5fDns5QqFZJDh+jctx+r5NKRxAgojY6iJIGVK3HShK6XXiKdNw/T0YEq47ivv04GdNx2%20G9bARrLHHoPF12OMhSoV9M5J9N8/x+q/CuLxcwonKkolpZKy5m59jycqahw4IH9goOD4GfTc2nFz%20J607Y3CTgpcPKK5VL6s3rFQUj4+LvPVjHLUPtp95plS5MkmJJP9ne+XNnl0YLpUuoLtUKiqkt1fe%208LCSmfJ5drHOGbZySSZPEuWOA4j8gw/IPzoHQQC9PVg3r8KaPbtARBxj3A7iM38iHbqTjg/OFIAC%20TJoSLV2Cc/Ag7pKlKA6h1AHGkHt19M47qFaDri6s+fOxliwBY2FlKUaSwhMniJ5/HhMnEIWYLING%20A6ansVauxH18N/acK5HvYbpnEZ/7iGztOtzxcQQk8+Zhv3Ec99r57TNZrUr8+PfI330X+vqgqwvZ%20dlFtrkvHww/T+ZnPFAxsL1wAfx6ldOj3uIcP45TL2IGPWbOGPM8I7r6H+OgRTPcsct/DvXY+ZvhF%20UiADzPCLFxmPjx0lGLqTLEsx69Zihw1K5TLu4SO4r7+OOXMGe+HCZrk1uxNv584LzDXjVvQ/9zmd%20/8HTqg4OKjz5dpHHRqBUknfPFnlbthR5bQTKJIUnT6q6cUDnf/C0/NsH2jfsTN3ezp3tzuhCQ5Ik%20qq9YURxy3YJOSyXFoKC3V9N7/kO1+7crVa60Sb/ea6/Kf/XVwqkkViJp+utf0/k9exQ027ioVCp0%20ua5iUH3FCiWtlizPL27JgiOH5bc8dZql1hQMbrpJtZ075e/fVxiMIyVpUiC+iXR/37Bq3/ymgjW3%20XHiRZtnGzRmiceTIRS1ZMcTYNqQpV2zYCMPDJIBJMyiVII6R62K/+y725CTpyZMFY5ZcbNuBNCGp%20VsmBdGQEa3oauzyC3EKWUgmTZSQAw8N0bthwYWICLkwKjgNpSte2bQRAvH07bpK0OdwA1sgI+dy5%20JCNvEb5ZxpJQXx/Z0WMYwLYM9ki5aGBygeti4rhtvGvbtk8MKO0x7lIn7CNHiJYtQ3GMSdPi8MQE%20ajTwfvYipAlptQpJjIkjTJaAH2AmJtvcoDgmWrYM68jhTzV++dmwCZIkCuXt2iWvp+gXw1JJtW3b%201Dh6VHmT2ZImqzX+cFS1rf+isLOzoOOeHnm7dikJw8tORZefDVsdazNPyeQk6QsvkL/2GvF119H9%202L9hL1gIWdrsfG3SD8fw9+zBHR/H2rSJ0gMP4Fx19Sd0Xbou70CrL7xkPM+rVczs2QhhTDODygGD%206nWsOXP+rvH8/wDSGwclTqZlUAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAyNS0wNS0zMVQxMzo0NDo1%20OCswMDowMGaVyN4AAAAldEVYdGRhdGU6bW9kaWZ5ADIwMjUtMDUtMzFUMTM6NDQ6NTgrMDA6MDAX%20yHBiAAAAKHRFWHRkYXRlOnRpbWVzdGFtcAAyMDI1LTA1LTMxVDEzOjQ0OjU4KzAwOjAwQN1RvQAA%20AABJRU5ErkJggg=='%20/%3e%3c/svg%3e",Ke={class:"logo"},Ne={key:0,class:"logo-text"},Ue={class:"sidebar-footer"},Xe={class:"app-version"},je={class:"header-left"},qe={class:"page-title"},Le={class:"header-right"},Je={class:"user-info"},Qe={class:"user-name"},Re={class:"footer-content"},We={class:"notification-drawer-header"},Ye={class:"notification-list"},Ee=["onClick"],Be={key:0,class:"notification-dot"},Ze={class:"notification-content"},$e={class:"notification-title"},et={class:"notification-time"},tt={class:"notification-preview"},at={class:"notification-pagination"},ot={key:0,class:"notification-detail"},st={class:"notification-detail-meta"},nt={class:"notification-detail-sender"},lt={class:"notification-detail-time"},it={class:"notification-detail-content"},rt={__name:"Dashboard",setup(dt){const W=xe(),Y=Ve(),I=Ce(),E=Me("appConfig"),u=f(localStorage.getItem("sidebarCollapsed")==="true"),m=f(!1),B=f(!0),Z=E?.version||"1.0.0",$=new Date().getFullYear(),x=f([]),g=f(0),y=f(!1),V=f(1),H=f(10),G=f(0),D=f(!1),w=f(null),ee={"/dashboard/search":"学生查询","/dashboard/profile":"个人中心","/dashboard/admin":"系统管理","/dashboard/superadmin":"超级管理"},te=k(()=>ee[Y.path]||"仪表盘"),b=k(()=>I.userInfo),ae=k(()=>b.value.role==="admin"||b.value.role==="superadmin"),oe=k(()=>b.value.role==="superadmin"),se=k(()=>b.value.account?b.value.account.substring(0,1).toUpperCase():"?"),ne=k(()=>m.value?u.value?"0px":"240px":u.value?"64px":"240px"),F=()=>{m.value=window.innerWidth<=768,m.value&&!localStorage.getItem("sidebarCollapsedManual")&&(u.value=!0)},K=()=>{u.value=!u.value,localStorage.setItem("sidebarCollapsed",u.value),localStorage.setItem("sidebarCollapsedManual","true")},S=async(o=V.value)=>{try{V.value=o;const e=await z.get("/api/notifications",{params:{page:V.value,page_size:H.value}});e.success?(x.value=e.notifications||[],G.value=e.total||0,g.value=e.unread_count||0):(console.error("获取通知失败:",e.message),M.error(e.message||"获取通知失败"))}catch(e){console.error("获取通知列表失败:",e)}},le=async o=>{try{if(!o||!o.id){console.error("通知数据不完整");return}if(w.value=o,D.value=!0,!o.is_read)try{(await z.post("/api/notifications/read",{notification_id:o.id})).success&&(o.is_read=!0,g.value>0&&g.value--)}catch(e){console.error("标记通知已读失败:",e)}}catch(e){console.error("查看通知详情失败:",e),M.error("查看通知详情失败，请稍后重试")}},ie=async()=>{if(g.value!==0)try{const o=[];for(const n of x.value)if(!n.is_read&&n.id){const P=z.post("/api/notifications/read",{notification_id:n.id}).then(C=>C.success?(n.is_read=!0,!0):!1).catch(C=>(console.error(`标记通知 ${n.id} 已读失败:`,C),!1));o.push(P)}const d=(await Promise.allSettled(o)).filter(n=>n.status==="fulfilled"&&n.value===!0).length;g.value=0,d>0?M.success(`已将 ${d} 条通知标记为已读`):M.warning("没有通知需要标记为已读")}catch(o){console.error("标记全部已读失败:",o),M.error("操作失败，请稍后重试")}},N=o=>{if(!o)return"";const e=new Date(o),n=Math.floor((new Date-e)/1e3);return n<60?"刚刚":n<3600?`${Math.floor(n/60)}分钟前`:n<86400?`${Math.floor(n/3600)}小时前`:n<604800?`${Math.floor(n/86400)}天前`:`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},re=(o,e)=>o?o.length<=e?o:o.substring(0,e)+"...":"",U=()=>{F()},de=o=>{switch(o){case"profile":W.push("/dashboard/profile");break;case"settings":break;case"logout":I.logout();break}};return ye(()=>{F(),window.addEventListener("resize",U),S();const o=setInterval(()=>{S()},6e4);q(()=>{clearInterval(o)})}),q(()=>{window.removeEventListener("resize",U)}),(o,e)=>{const d=l("el-icon"),n=l("el-menu-item"),P=l("el-menu"),C=l("el-aside"),X=l("el-button"),ue=l("el-badge"),ce=l("el-avatar"),T=l("el-dropdown-item"),fe=l("el-dropdown-menu"),ve=l("el-dropdown"),pe=l("el-header"),me=l("router-view"),ge=l("el-main"),_e=l("el-footer"),j=l("el-container"),Ae=l("el-pagination"),he=l("el-empty"),we=l("el-drawer"),be=l("el-dialog");return r(),_(j,{class:"dashboard-container"},{default:t(()=>[m.value&&!u.value?(r(),h("div",{key:0,class:"mobile-overlay",onClick:K})):A("",!0),a(C,{width:ne.value,class:O(["sidebar",{collapsed:u.value&&!m.value,"mobile-sidebar":m.value,"mobile-open":m.value&&!u.value}])},{default:t(()=>[s("div",Ke,[e[4]||(e[4]=s("img",{src:Fe,alt:"Logo",class:"logo-img"},null,-1)),!u.value||m.value?(r(),h("h2",Ne,"学生信息系统")):A("",!0)]),a(P,{"default-active":o.$route.path,class:"menu",router:"",collapse:u.value&&!m.value,"collapse-transition":!1,"unique-opened":!0,"text-color":"#fff","active-text-color":"#ffffff","background-color":"transparent"},{default:t(()=>[a(n,{index:"/dashboard/search",class:"menu-item"},{title:t(()=>e[5]||(e[5]=[p("学生查询")])),default:t(()=>[a(d,null,{default:t(()=>[a(c(De))]),_:1})]),_:1}),a(n,{index:"/dashboard/profile",class:"menu-item"},{title:t(()=>e[6]||(e[6]=[p("个人中心")])),default:t(()=>[a(d,null,{default:t(()=>[a(c(L))]),_:1})]),_:1}),ae.value?(r(),_(n,{key:0,index:"/dashboard/admin",class:"menu-item"},{title:t(()=>e[7]||(e[7]=[p("系统管理")])),default:t(()=>[a(d,null,{default:t(()=>[a(c(J))]),_:1})]),_:1})):A("",!0),oe.value?(r(),_(n,{key:1,index:"/dashboard/superadmin",class:"menu-item"},{title:t(()=>e[8]||(e[8]=[p("超级管理")])),default:t(()=>[a(d,null,{default:t(()=>[a(c(Se))]),_:1})]),_:1})):A("",!0)]),_:1},8,["default-active","collapse"]),s("div",Ue,[s("span",Xe,"v"+v(c(Z)),1)])]),_:1},8,["width","class"]),a(j,{class:"main-container"},{default:t(()=>[a(pe,{class:"header"},{default:t(()=>[s("div",je,[a(X,{type:"text",onClick:K,class:O(["menu-toggle",{"menu-toggle-active":!u.value}])},{default:t(()=>[a(d,{size:20,class:"toggle-icon"},{default:t(()=>[(r(),_(Q(u.value?c(Pe):c(Te))))]),_:1})]),_:1},8,["class"]),s("h3",qe,v(te.value),1)]),s("div",Le,[a(ue,{value:g.value>0?g.value:"",class:"notification-badge"},{default:t(()=>[a(d,{class:"notification-icon",onClick:e[0]||(e[0]=i=>y.value=!0)},{default:t(()=>[a(c(Oe))]),_:1})]),_:1},8,["value"]),a(ve,{onCommand:de,trigger:"click"},{dropdown:t(()=>[a(fe,null,{default:t(()=>[a(T,{command:"profile"},{default:t(()=>[a(d,null,{default:t(()=>[a(c(L))]),_:1}),e[9]||(e[9]=p("个人中心 "))]),_:1}),a(T,{command:"settings"},{default:t(()=>[a(d,null,{default:t(()=>[a(c(J))]),_:1}),e[10]||(e[10]=p("设置 "))]),_:1}),a(T,{command:"logout",divided:""},{default:t(()=>[a(d,null,{default:t(()=>[a(c(Ie))]),_:1}),e[11]||(e[11]=p("退出登录 "))]),_:1})]),_:1})]),default:t(()=>[s("div",Je,[a(ce,{size:32,class:"user-avatar"},{default:t(()=>[p(v(se.value),1)]),_:1}),s("span",Qe,v(b.value.account),1),a(d,null,{default:t(()=>[a(c(ze))]),_:1})])]),_:1})])]),_:1}),a(ge,{class:"main"},{default:t(()=>[a(me,null,{default:t(({Component:i})=>[a(He,{name:"fade",mode:"out-in"},{default:t(()=>[(r(),_(Q(i)))]),_:2},1024)]),_:1})]),_:1}),B.value?(r(),_(_e,{key:0,class:"footer"},{default:t(()=>[s("div",Re,[s("span",null,"© "+v(c($))+" 李端棻中学报名系统",1),e[12]||(e[12]=s("span",null,"|",-1)),e[13]||(e[13]=s("span",null,"技术支持: IT部门",-1))])]),_:1})):A("",!0)]),_:1}),a(we,{modelValue:y.value,"onUpdate:modelValue":e[2]||(e[2]=i=>y.value=i),title:"通知中心",direction:"rtl",size:"350px"},{header:t(()=>[s("div",We,[e[15]||(e[15]=s("h3",null,"通知中心",-1)),x.value.length>0?(r(),_(X,{key:0,type:"primary",text:"",onClick:ie,disabled:g.value===0},{default:t(()=>e[14]||(e[14]=[p(" 全部已读 ")])),_:1},8,["disabled"])):A("",!0)])]),default:t(()=>[s("div",Ye,[x.value.length>0?(r(),h(R,{key:0},[(r(!0),h(R,null,Ge(x.value,i=>(r(),h("div",{key:i.id,class:O(["notification-item",{unread:!i.is_read}]),onClick:ut=>le(i)},[i.is_read?A("",!0):(r(),h("div",Be)),s("div",Ze,[s("div",$e,v(i.title),1),s("div",et,v(N(i.create_time)),1),s("div",tt,v(re(i.content,50)),1)])],10,Ee))),128)),s("div",at,[a(Ae,{"current-page":V.value,"onUpdate:currentPage":e[1]||(e[1]=i=>V.value=i),"page-size":H.value,layout:"prev, pager, next",total:G.value,onCurrentChange:S,small:""},null,8,["current-page","page-size","total"])])],64)):(r(),_(he,{key:1,description:"暂无通知","image-size":100}))])]),_:1},8,["modelValue"]),a(be,{modelValue:D.value,"onUpdate:modelValue":e[3]||(e[3]=i=>D.value=i),title:w.value?.title||"通知详情",width:"500px"},{default:t(()=>[w.value?(r(),h("div",ot,[s("div",st,[s("div",nt,[e[16]||(e[16]=s("span",{class:"meta-label"},"发送人:",-1)),p(" "+v(w.value.sender),1)]),s("div",lt,v(N(w.value.create_time)),1)]),s("div",it,v(w.value.content),1)])):A("",!0)]),_:1},8,["modelValue","title"])]),_:1})}}},vt=ke(rt,[["__scopeId","data-v-0e252156"]]);export{vt as default};
