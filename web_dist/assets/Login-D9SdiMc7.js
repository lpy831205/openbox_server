import{_ as F,u as L,a as M,r as u,o as N,b as q,c as s,d as w,e as h,f as i,g as o,w as t,h as K,i as U,j as D,k as y,l as I,m as T,n as x,E as j}from"./index-IjbujgFK.js";import"./crypto-wasm-7Ru5Q_sa.js";const z={class:"login-container"},P={class:"login-content"},R={key:0,class:"error-message"},Z={class:"form-footer"},V=5,$={__name:"Login",setup(G){const g=L(),c=M(),l=u(!1),r=u(""),d=u(0),p=u(null),a=u({account:"",password:""}),k={account:[{required:!0,message:"请输入账号",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[\S]{6,}$/,message:"密码必须包含大小写字母和数字",trigger:"blur"}]};N(async()=>{await c.fetchPublicKey(),await c.generateDeviceCode(),c.isAuthenticated&&g.push("/dashboard"),setTimeout(()=>{const n=document.querySelector('input[autocomplete="username"]');n&&n.focus()},500)});const m=()=>{r.value=""},v=async()=>{if(!l.value)try{if(!p.value)return;if(await p.value.validate(),d.value>=V){r.value="登录尝试次数过多，请稍后再试";return}l.value=!0,m(),await c.login(a.value),j.success("登录成功"),g.push("/dashboard"),d.value=0}catch(n){d.value++,r.value=n.message||"登录失败，请检查账号和密码",a.value.password="",d.value>=V&&(r.value="登录尝试次数过多，请稍后再试")}finally{l.value=!1}};return q(()=>{m()}),(n,e)=>{const b=s("el-input"),f=s("el-form-item"),A=s("el-alert"),S=s("el-button"),B=s("router-link"),C=s("el-form"),E=s("el-card");return h(),w("div",z,[i("div",P,[o(E,{class:"login-card"},{header:t(()=>e[2]||(e[2]=[i("div",{class:"card-header"},[i("h2",null,"李端棻中学报名系统"),i("p",{class:"subtitle"},"登录")],-1)])),default:t(()=>[o(C,{ref_key:"loginForm",ref:p,model:a.value,rules:k,"label-position":"top",onSubmit:U(v,["prevent"]),onKeyup:K(v,["enter"])},{default:t(()=>[o(f,{label:"账号",prop:"account"},{default:t(()=>[o(b,{modelValue:a.value.account,"onUpdate:modelValue":e[0]||(e[0]=_=>a.value.account=_),placeholder:"请输入账号","prefix-icon":y(I),autocomplete:"username",disabled:l.value,onFocus:m},null,8,["modelValue","prefix-icon","disabled"])]),_:1}),o(f,{label:"密码",prop:"password"},{default:t(()=>[o(b,{modelValue:a.value.password,"onUpdate:modelValue":e[1]||(e[1]=_=>a.value.password=_),type:"password",placeholder:"请输入密码","prefix-icon":y(T),"show-password":"",autocomplete:"current-password",disabled:l.value,onFocus:m},null,8,["modelValue","prefix-icon","disabled"])]),_:1}),r.value?(h(),w("div",R,[o(A,{title:r.value,type:"error","show-icon":"",closable:!1},null,8,["title"])])):D("",!0),o(f,null,{default:t(()=>[o(S,{type:"primary","native-type":"submit",loading:l.value,class:"submit-btn"},{default:t(()=>e[3]||(e[3]=[x(" 登录 ")])),_:1},8,["loading"])]),_:1}),i("div",Z,[o(B,{to:"/register",class:"register-link"},{default:t(()=>e[4]||(e[4]=[x(" 没有账号？立即注册 ")])),_:1})])]),_:1},8,["model"])]),_:1})])])}}},O=F($,[["__scopeId","data-v-52623afe"]]);export{O as default};
