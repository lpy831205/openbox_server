import{_ as oe,r as p,y as re,N as ue,O as ie,o as de,c as u,P as ce,d as pe,e as z,g as e,Q as U,w as t,i as me,h as T,k as h,l as _e,R as ve,B as fe,n,S as ge,f as b,p as F,t as o,U as he,V as R,W as be,j as we,X as ye,Y as Ce,M as I,E as P}from"./index-IjbujgFK.js";import"./crypto-wasm-7Ru5Q_sa.js";const Se={class:"search-container"},ke={class:"card-header"},Ve={class:"card-header"},xe={class:"header-actions"},De={class:"pagination"},Ue={class:"dialog-footer"},ze={__name:"Search",setup(Re){const L=l=>{if(!l)return"";try{return new Date(l).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1})}catch{return l}},s=p({name:"",class:""}),K=p(null),m=p([]),g=p(!1),w=p(1),y=p(10),C=p(0),N=p("register_time"),B=p("descending"),x=p(!1),r=p({}),Q=re(()=>{const l=(w.value-1)*y.value,a=l+y.value;return m.value.slice(l,a)}),W=ue(()=>{(s.value.name.length>=2||s.value.class.length>=2)&&k()},500);ie(()=>[s.value.name,s.value.class],()=>{W()}),de(()=>{const l=new URLSearchParams(window.location.search),a=l.get("name"),c=l.get("class");(a||c)&&(s.value.name=a||"",s.value.class=c||"",k())});const D=async()=>{try{g.value=!0;const l={name:s.value.name,class:s.value.class,page:w.value,size:y.value},a=await I.get("/api/students",{params:l});a&&a.students?(m.value=a.students||[],C.value=a.students.length,j({prop:N.value,order:B.value}),X()):(m.value=[],C.value=0)}catch(l){P.error("查询失败："+(l.message||"未知错误")),m.value=[],C.value=0}finally{g.value=!1}},X=()=>{const l=new URLSearchParams;s.value.name&&l.set("name",s.value.name),s.value.class&&l.set("class",s.value.class);const a=`${window.location.pathname}${l.toString()?"?"+l.toString():""}`;window.history.replaceState({},"",a)},k=()=>{w.value=1,D()},E=()=>{s.value={name:"",class:""},w.value=1,D()},$=()=>{!s.value.name&&!s.value.class&&E()},Y=l=>{y.value=l,D()},q=l=>{w.value=l},j=({prop:l,order:a})=>{l&&(N.value=l,B.value=a,m.value.sort((c,V)=>{let f=c[l],_=V[l];return l==="register_time"&&(f=new Date(f).getTime(),_=new Date(_).getTime()),(l==="max_students"||l==="current_students")&&(f=Number(f)||0,_=Number(_)||0),a==="ascending"?f>_?1:-1:f<_?1:-1}))},A=()=>{D()},G=l=>{r.value=l,x.value=!0},H=async()=>{try{g.value=!0;const l=await I.get("/api/export-students",{params:s.value,responseType:"blob"}),a=new Blob([l],{type:"application/vnd.ms-excel"}),c=document.createElement("a");c.href=window.URL.createObjectURL(a),c.download=`学生信息_${new Date().toLocaleDateString()}.xlsx`,c.click(),window.URL.revokeObjectURL(c.href),P.success("导出成功")}catch(l){P.error("导出失败："+(l.message||"未知错误"))}finally{g.value=!1}},J=l=>l||"未提供";return(l,a)=>{const c=u("el-tag"),V=u("el-icon"),f=u("el-input"),_=u("el-form-item"),S=u("el-button"),Z=u("el-form"),M=u("el-card"),O=u("el-tooltip"),v=u("el-table-column"),ee=u("el-table"),ae=u("el-empty"),te=u("el-pagination"),i=u("el-descriptions-item"),le=u("el-descriptions"),ne=u("el-dialog"),se=ce("loading");return z(),pe("div",Se,[e(M,{class:"search-form"},{header:t(()=>[b("div",ke,[a[7]||(a[7]=b("span",null,"学生报名信息查询",-1)),e(c,{type:"info",effect:"plain"},{default:t(()=>a[6]||(a[6]=[n("支持模糊搜索")])),_:1})])]),default:t(()=>[e(Z,{model:s.value,inline:!0,onSubmit:me(k,["prevent"]),ref_key:"searchFormRef",ref:K},{default:t(()=>[e(_,{label:"姓名",prop:"name"},{default:t(()=>[e(f,{modelValue:s.value.name,"onUpdate:modelValue":a[0]||(a[0]=d=>s.value.name=d),placeholder:"支持模糊搜索",clearable:"",onClear:$,onKeyup:T(k,["enter"])},{prefix:t(()=>[e(V,null,{default:t(()=>[e(h(_e))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"班级",prop:"class"},{default:t(()=>[e(f,{modelValue:s.value.class,"onUpdate:modelValue":a[1]||(a[1]=d=>s.value.class=d),placeholder:"如：2310、23级10班",clearable:"",onClear:$,onKeyup:T(k,["enter"])},{prefix:t(()=>[e(V,null,{default:t(()=>[e(h(ve))]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(_,null,{default:t(()=>[e(S,{type:"primary","native-type":"submit",loading:g.value,icon:h(fe)},{default:t(()=>a[8]||(a[8]=[n(" 查询 ")])),_:1},8,["loading","icon"]),e(S,{onClick:E,icon:h(ge)},{default:t(()=>a[9]||(a[9]=[n(" 重置 ")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1}),U((z(),F(M,{class:"search-result"},{header:t(()=>[b("div",Ve,[b("span",null,[a[10]||(a[10]=n("查询结果 ")),m.value.length?(z(),F(c,{key:0,type:"success",size:"small"},{default:t(()=>[n("共 "+o(C.value)+" 条记录",1)]),_:1})):we("",!0)]),b("div",xe,[e(O,{content:"刷新数据",placement:"top","hide-after":1500},{default:t(()=>[e(S,{circle:"",icon:h(ye),onClick:A,disabled:g.value||!m.value.length},null,8,["icon","disabled"])]),_:1}),e(O,{content:"导出数据",placement:"top","hide-after":1500},{default:t(()=>[e(S,{circle:"",type:"primary",icon:h(Ce),onClick:H,disabled:g.value||!m.value.length},null,8,["icon","disabled"])]),_:1})])])]),default:t(()=>[U(e(ee,{data:Q.value,style:{width:"100%"},border:"",stripe:"","highlight-current-row":"","default-sort":{prop:"register_time",order:"descending"},onSortChange:j,"row-key":"id"},{default:t(()=>[e(v,{prop:"name",label:"姓名",width:"100",sortable:""}),e(v,{prop:"class",label:"班级",width:"120",sortable:""}),e(v,{prop:"course",label:"课程",width:"120",sortable:""}),e(v,{prop:"course_type",label:"课程类型",width:"100",sortable:""}),e(v,{prop:"teacher",label:"任课教师",width:"100",sortable:""}),e(v,{prop:"time",label:"上课时间",width:"120","show-overflow-tooltip":""}),e(v,{prop:"max_students",label:"人数上限",width:"100",sortable:""}),e(v,{prop:"current_students",label:"已报名",width:"100",sortable:""}),e(v,{prop:"register_time",label:"报名时间",width:"160",sortable:""},{default:t(({row:d})=>[n(o(L(d.register_time)),1)]),_:1}),e(v,{fixed:"right",label:"操作",width:"120"},{default:t(({row:d})=>[e(S,{link:"",type:"primary",onClick:Pe=>G(d),icon:h(he)},{default:t(()=>a[11]||(a[11]=[n(" 查看详情 ")])),_:2},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"]),[[R,m.value.length]]),U(e(ae,{description:"暂无数据"},{image:t(()=>[e(V,{size:60},{default:t(()=>[e(h(be))]),_:1})]),description:t(()=>a[12]||(a[12]=[b("span",null,"暂无查询结果，请尝试其他搜索条件",-1)])),_:1},512),[[R,!m.value.length]]),U(b("div",De,[e(te,{"current-page":w.value,"onUpdate:currentPage":a[2]||(a[2]=d=>w.value=d),"page-size":y.value,"onUpdate:pageSize":a[3]||(a[3]=d=>y.value=d),"page-sizes":[10,20,50,100],total:C.value,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:Y,onCurrentChange:q},null,8,["current-page","page-size","total"])],512),[[R,C.value>0]])]),_:1})),[[se,g.value]]),e(ne,{modelValue:x.value,"onUpdate:modelValue":a[5]||(a[5]=d=>x.value=d),title:"学生详细信息",width:"50%","destroy-on-close":"",draggable:""},{footer:t(()=>[b("span",Ue,[e(S,{onClick:a[4]||(a[4]=d=>x.value=!1)},{default:t(()=>a[13]||(a[13]=[n("关闭")])),_:1})])]),default:t(()=>[e(le,{column:2,border:""},{default:t(()=>[e(i,{label:"学期"},{default:t(()=>[n(o(r.value.term),1)]),_:1}),e(i,{label:"姓名"},{default:t(()=>[n(o(r.value.name),1)]),_:1}),e(i,{label:"班级"},{default:t(()=>[n(o(r.value.class),1)]),_:1}),e(i,{label:"年级"},{default:t(()=>[n(o(r.value.grade),1)]),_:1}),e(i,{label:"课程"},{default:t(()=>[n(o(r.value.course),1)]),_:1}),e(i,{label:"课程类型"},{default:t(()=>[n(o(r.value.course_type),1)]),_:1}),e(i,{label:"任课教师"},{default:t(()=>[n(o(r.value.teacher),1)]),_:1}),e(i,{label:"上课时间"},{default:t(()=>[n(o(r.value.time),1)]),_:1}),e(i,{label:"报名人数上限"},{default:t(()=>[n(o(r.value.max_students),1)]),_:1}),e(i,{label:"已报名人数"},{default:t(()=>[n(o(r.value.current_students),1)]),_:1}),e(i,{label:"报名时间"},{default:t(()=>[n(o(L(r.value.register_time)),1)]),_:1}),e(i,{label:"身份证号",span:2},{default:t(()=>[n(o(J(r.value.id_card)),1)]),_:1}),e(i,{label:"备注",span:2},{default:t(()=>[n(o(r.value.notes||"无"),1)]),_:1}),e(i,{label:"确认信息",span:2},{default:t(()=>[n(o(r.value.confirm_info||"无"),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])}}},Be=oe(ze,[["__scopeId","data-v-7182f916"]]);export{Be as default};
