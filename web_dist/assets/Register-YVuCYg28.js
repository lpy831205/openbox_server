import{_ as N,u as z,a as T,r as m,o as Z,c as l,d as K,e as x,g as t,w as o,p as h,f as u,i as P,k as n,q as j,n as y,l as G,m as R,t as H,s as J,E as i}from"./index-IjbujgFK.js";import"./crypto-wasm-7Ru5Q_sa.js";const L={class:"register-container"},O={class:"card-header"},Q={class:"device-code-info"},W={class:"device-code-text"},X={class:"password-strength-tip"},Y={class:"form-footer"},ee={__name:"Register",setup(te){const S=z(),s=T(),c=m(!1),f=m(0),v=m({inviteCode:""}),r=m({account:"",password:"",confirmPassword:""}),w=m(null),C=m(null),q={inviteCode:[{required:!0,message:"请输入邀请码",trigger:"blur"},{min:10,message:"邀请码格式不正确",trigger:"blur"}]},D={account:[{required:!0,message:"请输入账号",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"},{pattern:/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[a-zA-Z\d]{6,}$/,message:"密码必须包含大小写字母和数字",trigger:"blur"}],confirmPassword:[{required:!0,message:"请再次输入密码",trigger:"blur"},{validator:(a,e,_)=>{e!==r.value.password?_(new Error("两次输入的密码不一致")):_()},trigger:"blur"}]};Z(async()=>{await s.fetchPublicKey(),await s.generateDeviceCode()});const E=async()=>{if(!w.value){i.error("表单引用错误");return}try{if(!await w.value.validate())return}catch{return}try{c.value=!0,await s.verifyInviteCode(v.value.inviteCode),i.success("邀请码验证成功"),f.value=1}catch(a){i.error(a.message)}finally{c.value=!1}},B=async()=>{if(!C.value){i.error("表单引用错误");return}try{if(!await C.value.validate())return}catch{return}try{c.value=!0,await s.register({account:r.value.account,password:r.value.password,inviteCode:v.value.inviteCode}),i.success("注册成功，请登录"),S.push("/login")}catch(a){i.error(a.message)}finally{c.value=!1}},F=async()=>{if(s.deviceCode)try{if(navigator.clipboard)await navigator.clipboard.writeText(s.deviceCode),i.success("设备码已复制到剪贴板");else{const a=document.createElement("textarea");a.value=s.deviceCode,document.body.appendChild(a),a.select(),document.execCommand("copy"),document.body.removeChild(a),i.success("设备码已复制到剪贴板")}}catch(a){i.error("复制失败，请手动复制"),console.error("复制设备码失败:",a)}};return(a,e)=>{const _=l("el-tooltip"),U=l("el-icon"),g=l("el-button"),k=l("el-step"),$=l("el-steps"),b=l("el-input"),p=l("el-form-item"),V=l("el-form"),A=l("el-alert"),I=l("router-link"),M=l("el-card");return x(),K("div",L,[t(M,{class:"register-card"},{header:o(()=>[u("div",O,[e[6]||(e[6]=u("h2",null,"注册",-1)),u("div",Q,[e[5]||(e[5]=u("span",null,"设备码:",-1)),t(_,{class:"box-item",effect:"dark",content:n(s).deviceCode||"加载中...",placement:"top"},{default:o(()=>[u("span",W,H(n(s).deviceCode?`${n(s).deviceCode.slice(0,8)}...${n(s).deviceCode.slice(-8)}`:"加载中..."),1)]),_:1},8,["content"]),t(g,{link:"",onClick:F,disabled:!n(s).deviceCode},{default:o(()=>[t(U,null,{default:o(()=>[t(n(J))]),_:1})]),_:1},8,["disabled"])])])]),default:o(()=>[t($,{active:f.value,"finish-status":"success",class:"steps"},{default:o(()=>[t(k,{title:"验证邀请码"}),t(k,{title:"创建账号"})]),_:1},8,["active"]),f.value===0?(x(),h(V,{key:0,ref_key:"inviteForm",ref:w,model:v.value,rules:q,"label-position":"top",onSubmit:P(E,["prevent"]),class:"invite-form"},{default:o(()=>[t(p,{label:"邀请码",prop:"inviteCode",class:"invite-form-item"},{default:o(()=>[t(b,{modelValue:v.value.inviteCode,"onUpdate:modelValue":e[0]||(e[0]=d=>v.value.inviteCode=d),placeholder:"请输入邀请码","prefix-icon":n(j)},null,8,["modelValue","prefix-icon"])]),_:1}),t(p,null,{default:o(()=>[t(g,{type:"primary","native-type":"submit",loading:c.value,class:"submit-btn"},{default:o(()=>e[7]||(e[7]=[y(" 验证 ")])),_:1},8,["loading"])]),_:1})]),_:1},8,["model"])):(x(),h(V,{key:1,ref_key:"registerForm",ref:C,model:r.value,rules:D,"label-position":"top",onSubmit:P(B,["prevent"])},{default:o(()=>[t(p,{label:"账号",prop:"account"},{default:o(()=>[t(b,{modelValue:r.value.account,"onUpdate:modelValue":e[1]||(e[1]=d=>r.value.account=d),placeholder:"请输入账号","prefix-icon":n(G)},null,8,["modelValue","prefix-icon"])]),_:1}),t(p,{label:"密码",prop:"password"},{default:o(()=>[t(b,{modelValue:r.value.password,"onUpdate:modelValue":e[2]||(e[2]=d=>r.value.password=d),type:"password",placeholder:"请输入密码","prefix-icon":n(R),"show-password":""},null,8,["modelValue","prefix-icon"]),u("div",X,[t(A,{title:"密码必须包含大小写字母和数字，且长度至少为6位",type:"info",closable:!1,"show-icon":""})])]),_:1}),t(p,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[t(b,{modelValue:r.value.confirmPassword,"onUpdate:modelValue":e[3]||(e[3]=d=>r.value.confirmPassword=d),type:"password",placeholder:"请再次输入密码","prefix-icon":n(R),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),t(p,null,{default:o(()=>[t(g,{type:"primary","native-type":"submit",loading:c.value,class:"submit-btn"},{default:o(()=>e[8]||(e[8]=[y(" 注册 ")])),_:1},8,["loading"]),t(g,{onClick:e[4]||(e[4]=d=>f.value=0),class:"back-btn"},{default:o(()=>e[9]||(e[9]=[y(" 返回 ")])),_:1})]),_:1})]),_:1},8,["model"])),u("div",Y,[t(I,{to:"/login",class:"login-link"},{default:o(()=>e[10]||(e[10]=[y(" 已有账号？立即登录 ")])),_:1})])]),_:1})])}}},se=N(ee,[["__scopeId","data-v-7cb3838b"]]);export{se as default};
